const CONFIG={BASE_URL:"https://raw.githubusercontent.com/elitemassagemx/Home/main/IMG/",API_URL:"https://raw.githubusercontent.com/elitemassagemx/Home/main/data.json",WHATSAPP_NUMBER:"5215640020305"},CAROUSEL_IMAGE_BASE_URL="https://raw.githubusercontent.com/elitemassagemx/prueba/main/carruimg/",App={state:{services:{},currentCategory:"masajes",initialized:!1},init:async function(){try{const e=await fetch(CONFIG.API_URL);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();this.state.services=t.services,this.renderServices(),this.setupEventListeners(),this.state.initialized=!0,this.loadCarouselContent(),this.setupGallery(),this.setupGalleryAnimations(),this.setupGalleryModal(),this.setupFilters()}catch(e){console.error("Error initializing app:",e)}},buildImageUrl:function(e){return e?e.startsWith("http")?e:`${CONFIG.BASE_URL}${e.startsWith("/")?e.slice(1):e}`:`${CONFIG.BASE_URL}default-icon.webp`},handleImageError:function(e){console.warn(`Failed to load image: ${e.src}`),e.src=`${CONFIG.BASE_URL}default-icon.webp`,e.onerror=null},renderServices:function(){const e=document.getElementById("services-grid");if(!e)return;e.innerHTML="";const t=this.state.services[this.state.currentCategory];if(!Array.isArray(t))return void(e.innerHTML="<p>No se encontraron servicios disponibles</p>");const n=document.createDocumentFragment();t.forEach(e=>{const t=this.createServiceElement(e);n.appendChild(t)}),e.appendChild(n),this.renderBenefitsNav(t)},createServiceElement:function(e){const t=document.querySelector("#service-template");if(!t)return document.createElement("div");const n=t.content.cloneNode(!0),i=n.querySelector(".service-icon");return i&&(i.src=this.buildImageUrl(e.icon),i.alt=e.title||"Service icon",i.onerror=()=>{App.handleImageError(i)}),n.querySelector(".service-title").textContent=e.title||"",n.querySelector(".service-description").textContent=e.description||"",this.populateBenefits(n,e),n.querySelector(".duration-text").textContent=e.duration||"",n},populateBenefits:function(e,t){if(!t.benefits||!t.benefitsIcons)return;const n=e.querySelector(".service-benefits");n.innerHTML="",t.benefits.forEach((e,i)=>{const r=document.createElement("div");r.className="benefit-item";const s=document.createElement("img");s.src=this.buildImageUrl(t.benefitsIcons[i]),s.alt=e,s.className="benefit-icon",s.onerror=()=>{App.handleImageError(s)};const o=document.createElement("span");o.textContent=e,r.appendChild(s),r.appendChild(o),n.appendChild(r)})},renderBenefitsNav:function(e){const t=document.querySelector(".benefits-nav");if(!t)return;const n=new Set,i=new Map;e.forEach(e=>{e.benefits?.forEach((t,n)=>{i.set(t,e.benefitsIcons[n])}),e.benefits?.forEach(e=>n.add(e))}),t.innerHTML=`<button class="benefit-btn active" data-filter="all"><img src="${this.buildImageUrl("todos.webp")}" alt="Todos" onerror="()=>{App.handleImageError(this)}"><span>Todos</span></button>${Array.from(n).map(e=>`<button class="benefit-btn" data-filter="${e.toLowerCase().replace(/\s+/g,"-")}"><img src="${this.buildImageUrl(i.get(e))}" alt="${e}" onerror="()=>{App.handleImageError(this)}"><span>${e}</span></button>`).join("")}`,this.setupBenefitsFilter()},setupBenefitsFilter:function(){document.querySelectorAll(".benefit-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.filter;this.filterServices(t),document.querySelectorAll(".benefit-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active")})})},filterServices:function(e){document.querySelectorAll(".service-item").forEach(t=>{const n="all"===e||Array.from(t.querySelectorAll(".benefit-item span")).some(t=>t.textContent.toLowerCase()===e.replace(/-/g," ").toLowerCase());t.style.display=n?"block":"none"})},setupEventListeners:function(){document.querySelectorAll('.service-category-toggle input[type="radio"]').forEach(e=>{e.addEventListener("change",()=>{this.state.currentCategory=e.value,this.renderServices()})}),document.addEventListener("click",e=>{if(e.target.classList.contains("saber-mas-button")){const t=e.target.closest(".service-item");if(!t)return;const n=Array.from(t.parentNode.children).indexOf(t),i=this.state.services[this.state.currentCategory][n];this.showPopup(i)}}),document.querySelector(".popup .close")?.addEventListener("click",()=>this.hidePopup()),document.querySelector("#whatsapp-button")?.addEventListener("click",()=>{const e=document.querySelector("#popup-title")?.textContent;if(e){const t=`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=Hola, me interesa el servicio: ${encodeURIComponent(e)}`;window.open(t,"_blank")}})},showPopup:function(e){const t=document.getElementById("popup");if(!t)return;const n=t.querySelector(".popup-content"),i=t.querySelector("#popup-title"),r=t.querySelector("#popup-image"),s=t.querySelector("#popup-description"),o=t.querySelector(".popup-benefits"),a=t.querySelector(".popup-includes"),c=t.querySelector("#popup-duration");if(!n||!i||!r||!s||!o||!a||!c)return;i.textContent=e.title||"",r.src=this.buildImageUrl(e.popupImage||e.image),r.alt=e.title||"",r.onerror=()=>{App.handleImageError(r)},s.textContent=e.popupDescription||e.description||"",o.innerHTML="",a.innerHTML="",Array.isArray(e.benefits)&&Array.isArray(e.benefitsIcons)&&e.benefits.forEach((t,n)=>{const i=document.createElement("div");i.classList.add("popup-benefit-item");const r=document.createElement("img");r.src=this.buildImageUrl(e.benefitsIcons[n]),r.alt=t,r.onerror=()=>{App.handleImageError(r)};const s=document.createElement("span");s.textContent=t,i.appendChild(r),i.appendChild(s),o.appendChild(i)}),Array.isArray(e.includes)&&e.includes.forEach(e=>{const t=document.createElement("div");t.classList.add("popup-include-item");const n=document.createElement("img");n.src=this.buildImageUrl("check-icon.webp"),n.alt="Incluido",n.onerror=()=>{App.handleImageError(n)};const i=document.createElement("span");i.textContent=e,t.appendChild(n),t.appendChild(i),a.appendChild(t)}),c.textContent=e.duration||"",t.style.display="block"},hidePopup:function(){const e=document.getElementById("popup");e&&(e.style.display="none")},loadCarouselContent:function(){fetch("carrusel.html").then(e=>e.text()).then(e=>{document.getElementById("carrusel-container").innerHTML=e,this.initCarousel()}).catch(e=>console.error("Error loading carousel:",e))},initCarousel:function(){const e=document.getElementById("carrusel-container");if(!e)return void console.error("Carousel element not found");const t=e.querySelectorAll(".carousel-item");if(0===t.length)return void console.error("No carousel items found");const n=e.querySelector(".carousel-control.prev"),i=e.querySelector(".carousel-control.next");if(!n||!i)return void console.error("Carousel control buttons not found");const r=t[0].offsetWidth;let s=0;function o(t){const n=e.querySelector(".carousel");n.style.transform=`translateX(-${t*r}px)`,s=t,function(t){const n=e.querySelectorAll(".carousel-indicators button");n.forEach((e,n)=>{n===t?(e.classList.add("active"),e.setAttribute("aria-current","true")):(e.classList.remove("active"),e.removeAttribute("aria-current"))})}(t)}i.addEventListener("click",()=>{o(s<t.length-1?s+1:0)}),n.addEventListener("click",()=>{o(s>0?s-1:t.length-1)}),e.querySelectorAll(".carousel-indicators button").forEach((e,t)=>{e.addEventListener("click",()=>o(t))}),t.forEach(e=>{const t=e.querySelector("img");t&&(t.src=`${CAROUSEL_IMAGE_BASE_URL}${t.getAttribute("src")}`,t.onerror=()=>{App.handleImageError(t)})}),o(0)},setupGallery:function(){const e=document.querySelector(".gallery-grid"),t=document.getElementById("ver-mas-galeria");if(!e||!t)return;const n=[{src:"QUESOSAHM.webp",title:"Tabla Gourmet",description:"Después de tu masaje en pareja saborea una exquisita selección de jamón curado, quesos gourmet, fresas cubiertas de chocolate y copas de vino. Un toque de lujo y placer compartido para complementar tu visita"},{src:"choco2.webp",title:"Chocolate Deluxe",description:"Sumérgete en una experiencia de dulzura y relajación con nuestro tratamiento de chocolate"},{src:"SILLAS.webp",title:"Área de Relajación",description:"Disfruta de nuestro acogedor espacio de relajación antes o después de tu masaje"}];n.forEach(t=>{const n=document.createElement("div");n.classList.add("gallery-item"),n.innerHTML=`<img src="${this.buildImageUrl(t.src)}" alt="${t.title}" onerror="()=>{App.handleImageError(this)}"><div class="image-overlay"><h3 class="image-title">${t.title}</h3><p class="image-description">${t.description}</p></div>`,n.addEventListener("click",()=>{this.showImageDetails(t)}),e.appendChild(n)}),t.addEventListener("click",()=>{window.location.href="galeria.html"})},showImageDetails:function(e){const t=document.getElementById("imageModal"),n=document.getElementById("modalImage"),i=document.getElementById("modalDescription");t&&n&&i&&(n.src=this.buildImageUrl(e.src),n.alt=e.title,n.onerror=()=>{App.handleImageError(n)},i.innerHTML=`<h3>${e.title}</h3><p>${e.description}</p>`,t.style.display="block")},setupGalleryAnimations:function(){if("undefined"==typeof gsap||"undefined"==typeof ScrollTrigger)return void console.warn("GSAP or ScrollTrigger not loaded. Gallery animations will not work.");const e=document.querySelector(".gallery-container");if(!e)return;const t=gsap.utils.toArray(".gallery-container img");ScrollTrigger.create({trigger:e,start:"top 80%",end:"bottom 20%",onEnter:()=>{e.classList.add("is-visible"),function(){t.forEach((e,t)=>{gsap.fromTo(e,{scale:.8,opacity:0},{scale:1,opacity:1,duration:.5,ease:"power2.out",delay:.1*t})})}()},onLeave:()=>{e.classList.remove("is-visible")},onEnterBack:()=>{e.classList.add("is-visible"),function(){t.forEach((e,t)=>{gsap.fromTo(e,{scale:.8,opacity:0},{scale:1,opacity:1,duration:.5,ease:"power2.out",delay:.1*t})})}()},onLeaveBack:()=>{e.classList.remove("is-visible")}})},setupGalleryModal:function(){const e=document.getElementById("imageModal"),t=e.querySelector(".close");t.onclick=function(){e.style.display="none"},window.onclick=function(t){t.target==e&&(e.style.display="none")}},setupFilters:function(){this.setupFilterButtons(".benefits-nav","#services-list",".service-item"),this.setupFilterButtons(".package-nav","#package-list",".package-item")},setupFilterButtons:function(e,t,n){document.querySelectorAll(`${e} button`).forEach(e=>{e.addEventListener("click",()=>{const t=e.querySelector(".hidden-text").textContent.toLowerCase().replace(/\s+/g,"-");document.querySelectorAll(`${e} button`).forEach(e=>e.classList.remove("active")),e.classList.add("active"),document.querySelectorAll(n).forEach(e=>{("all"===t||e.classList.contains(t))&&(e.style.display="block")})})})}};document.addEventListener("DOMContentLoaded",()=>App.init());
